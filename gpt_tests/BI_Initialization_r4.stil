STIL 1.0; // 第一行必须STIL 1.0;开头
// Block顺序规定：STIL - Header - Signals - SignalGroups - ScanStructures - Spec - Timing - Selector \
// - PatternBurst - PatternExec - Procedures - MacroDefs - Pattern

Header  {
Title "tviibe2m_top_BI_Initialization_stil_gz" ;
  Date     "Thu Dec  6 19:02:50 2018" ;
  Source  "Tessent Shell  2016.4-p1-snapshot_2017.08.09_17.14" ;
  History  {
    Ann {*  Begin_Verify_Section  *}
    Ann {*    format            = STIL  *}
    Ann {*    serial_flag       = OFF  *}
    Ann {*    test_set_type     = CHAIN_TEST  *}
    Ann {*    pad_value         = X  *}
    Ann {*    pattern_begin     = 0  *}
    Ann {*    pattern_end       = 0  *}
    Ann {*    one_setup         = ON  *}
    Ann {*    no_initialization = OFF  *}
    Ann {*    pattern_checksum  = 0  *}
    Ann {*  End_Verify_Section  *}
  }
}

// 暂不支持Include “../x.stil”;
 
// Signals Block解析
Signals {
  "p2_0_pad" In; "p23_7_pad" In; "vccd_0_pad" In; "vccd_1_pad" In; "vccd_2_pad" In; "vccd_3_pad" In; "vdda_pad" In; "vddd_0_pad" In; "vddd_1_pad" In; "vddd_2_pad" In; "vddd_3_pad" In; "vddio_0_pad" In; "vddio_1_pad" In; "vddio_10_pad" In; "vddio_11_pad" In; "vddio_12_pad" In; "vddio_13_pad" In; "vddio_14_pad" In; "vddio_15_pad" In; "vddio_16_pad" In; "vddio_17_pad" In; "vddio_18_pad" In; "vddio_19_pad" In; "vddio_2_pad" In; "vddio_3_pad" In; "vddio_4_pad" In; "vddio_5_pad" In; "vddio_6_pad" In; "vddio_7_pad" In; "vddio_8_pad" In; "vddq_pad" In; "vrefh0_pad" In; "vrefh1_pad" In; "vrefl0_pad" In; "vrefl1_pad" In; "vssa_pad" In; "vssd_0_pad" In; "vssd_2_pad" In; "vssd_3_pad" In; "vssio_0_pad" In; "vssio_1_pad" In; "vssio_10_pad" In; "vssio_11_pad" In; "vssio_12_pad" In; "vssio_13_pad" In; "vssio_14_pad" In; "vssio_15_pad" In; "vssio_16_pad" In; "vssio_17_pad" In; "vssio_18_pad" In; "vssio_19_pad" In; 
  "vssio_2_pad" In; "vssio_3_pad" In; "vssio_4_pad" In; "vssio_5_pad" In; "vssio_6_pad" In; "vssio_7_pad" In; "vssq_pad" In; "vsub_pad" In; "xres_pad" In; 
  
  "p23_5_pad" Out; "p23_6_pad" InOut; 
  // 暂不支持ScanIn和ScanOut解析
}

// SignalGroups Block解析
SignalGroups {
  _pi_ = '"p2_0_pad" + "p23_7_pad" + "vccd_0_pad" + "vccd_1_pad" + "vccd_2_pad" + "vccd_3_pad" + "vdda_pad" + "vddd_0_pad" + "vddd_1_pad" + "vddd_2_pad" + "vddd_3_pad" + "vddio_0_pad" + "vddio_1_pad" + "vddio_10_pad" + "vddio_11_pad" + "vddio_12_pad" + "vddio_13_pad" + "vddio_14_pad" + "vddio_15_pad" + "vddio_16_pad" + "vddio_17_pad" + "vddio_18_pad" + "vddio_19_pad" + "vddio_2_pad" + "vddio_3_pad" + "vddio_4_pad" + "vddio_5_pad" + "vddio_6_pad" + "vddio_7_pad" + "vddio_8_pad" + "vddq_pad" + "vrefh0_pad" + "vrefh1_pad" + "vrefl0_pad" + "vrefl1_pad" + "vssa_pad" + "vssd_0_pad" + "vssd_2_pad" + "vssd_3_pad" + "vssio_0_pad" + "vssio_1_pad" + "vssio_10_pad" + "vssio_11_pad" + "vssio_12_pad" + "vssio_13_pad" + "vssio_14_pad" + 
       "vssio_15_pad" + "vssio_16_pad" + "vssio_17_pad" + "vssio_18_pad" + "vssio_19_pad" + "vssio_2_pad" + "vssio_3_pad" + "vssio_4_pad" + "vssio_5_pad" + "vssio_6_pad" + "vssio_7_pad" + "vssq_pad" + "vsub_pad" + "xres_pad"';
  _bidi_ = '"p23_5_pad" + "p23_6_pad"';
  input_time_gen_0 = '"p2_0_pad" + "p23_7_pad" + "vccd_0_pad" + "vccd_1_pad" + "vccd_2_pad" + "vccd_3_pad" + "vdda_pad" + "vddd_0_pad" + "vddd_1_pad" + "vddd_2_pad" + "vddd_3_pad" + "vddio_0_pad" + "vddio_1_pad" + "vddio_10_pad" + "vddio_11_pad" + "vddio_12_pad" + "vddio_13_pad" + "vddio_14_pad" + "vddio_15_pad" + "vddio_16_pad" + "vddio_17_pad" + "vddio_18_pad" + "vddio_19_pad" + "vddio_2_pad" + "vddio_3_pad" + "vddio_4_pad" + "vddio_5_pad" + "vddio_6_pad" + "vddio_7_pad" + "vddio_8_pad" + "vddq_pad" + "vrefh0_pad" + "vrefh1_pad" + "vrefl0_pad" + "vrefl1_pad" + "vssa_pad" + "vssd_0_pad" + "vssd_2_pad" + "vssd_3_pad" + "vssio_0_pad" + "vssio_1_pad" + "vssio_10_pad" + "vssio_11_pad" + "vssio_12_pad" + "vssio_13_pad" + "vssio_14_pad" + "vssio_15_pad" + "vssio_16_pad" + "vssio_17_pad" + "vssio_18_pad" + "vssio_19_pad" + "vssio_2_pad" + "vssio_3_pad" + "vssio_4_pad" + "vssio_5_pad" + "vssio_6_pad" + 
       "vssio_7_pad" + "vssq_pad" + "vsub_pad" + "xres_pad"';
  bidi_time_gen_0 = '"p23_5_pad"';
  bidi_time_gen_1 = '"p23_6_pad"';
  // 暂不支持 bidi_time_gen_2 = '(_bidi_ - p23_5_pad)'解析;
  // 暂不支持 bidi_time_gen_2 = 'p23_5_pad[0..31]'解析;
  // 暂不支持Base HEX和OCT、\h、\d、\l、\w编码压缩和解码功能
}

// Timing Block解析
Timing RETARGET_timing {
  WaveformTable tset__test_entry_entry_  {
    Period '100000ps' ;
    Waveforms  {
      input_time_gen_0  { 01XZ { '0ps' D/U/N/Z; }}
	  // Converted timing maybe not correct, Please check the timing definitions:
	  // If UDU and DUD in Timing+Group/Signal  DUD/UDU -> P/N
	  // If UUU and UDU and not DDD and not DUD in Timing+Group/Signal UUU/UDU -> RO
	  // If DDD and DUD and not UUU and not UDU in Timing+Group/Signal DDD/DUD -> RZ
	  // If DU/UD in Timing+Group/Signal  DU/UD -> DNRZ
	  // 如果Edge数量不一致，则将单个Edge重复展开相等数量
	  // 因为HTOL的Edge最多只有两个，如果Edge个数超过2个，取第二个和第三个
	  // 单位HTOL只支持nS单位，所以把ps/pS，us/uS，ms/mS，s/S会转换为nS，Timing的T值暂时不支持表达式写法
	  //bidi_time_gen_0 { 01 { '0ps' D; '25000ps' D/U; '75000ps' U/D;}
      bidi_time_gen_0 { 01 { '0ps' U/D; '25000ps' D/U; '75000ps' U/D;}
              Z { '0ps' Z;}
              LHXT { '0ps' Z; '24000ps' l/h/X/t; '24001ps' X;} }
      bidi_time_gen_1 { LHXT { '0ps' Z; '24000ps' l/h/X/t; '24001ps' X;}
              01Z { '0ps' D/U/Z;} }
    }
  }
  WaveformTable tset_gen_tp2  {
    Period '100000ps' ;
    Waveforms  {
      input_time_gen_0  { 01XZ { '0ps' D/U/N/Z; }}
      bidi_time_gen_0 { 01 { '0ps' D; '25000ps' D/U; '75000ps' D;}
              Z { '0ps' Z;}
              LHXT { '0ps' Z; '24000ps' l/h/X/t; '24001ps' X;} }
      bidi_time_gen_1 { LHXT { '0ps' Z; '24000ps' l/h/X/t; '24001ps' X;}
              01Z { '0ps' D/U/Z;} }
    }
  }
}
// NONE
PatternBurst scanpats {
  PatList { scan_test; }
}
// NONE
PatternExec {
  Timing RETARGET_timing;
  PatternBurst scanpats;
}

// MacroDefs Block宏解析，支持变量替换，执行完时序不恢复
MacroDefs {
  macro_z0 {
	macro_z_start: V {  _bidi_=11;
       _pi_=00 \r31 1 T00000000000000000000000000;
    }
  }
  macro_z1 {
	V {  _bidi_=#;
       _pi_=#;
    }
  }
}

// Procedures Block子Pattern解析，支持变量替换，执行完时序恢复
Procedures {
  proc0 {
    // call指令切换Timing
    W tset_gen_tp2;
	proc_start: V {  _bidi_=00;
       _pi_=00 \r31 1 000000000000000000000000000;
    }
	V {  _bidi_=00;
       _pi_=00 \r31 1 000000000000000000000000000;
    }
  }
  proc1 {
    // call参数替换
	replace: V {  _bidi_=#;
       _pi_=#;
    }
  }
}

// 支持Pattern Block解析
Pattern scan_test  {
  W tset__test_entry_entry_;
  // Pattern:0  Vector:1  TesterCycle:1
  // 注释跳过
  Ann {* Pattern:0  Vector:1  TesterCycle:1 *}
  // 支持不包含{}的单独指令，必须分号结尾
  // 支持Goto=JUMP 单指令
  Goto start;
  // 普通V
  V {  _bidi_=00;
       _pi_=001111111111111111111111111111111000000000000000000000000000;
  }
  // 支持带Label的V
  start: V {  _bidi_=00;
       _pi_=001111111111111111111111111111111000000000000000000000000000;
  }
  // Call子Pattern
  Call proc0;
  // Call参数替换
  Call proc1 {
	   _bidi_=11;
	   _pi_=00 \r31 1 000000000000000000000000000;
  }
  // call指令结束后要恢复Timing
  proc_end: V {  _bidi_=01;
       _pi_=00 \r31 1 000000000000000000000000000;
  }
  Macro macro_z0;
  // Macro参数替换
  Macro macro_z1 { _bidi_=11;
	   _pi_=00 \r31 1 000000000000000000000000000;
  }
  macro_z_end: // Label独立一行的写法
  V {  _bidi_=11;
       _pi_=00 \r31 1 000000000000000000000000000;
  }
  // MatchLoop指令 HTOL机型不支持，这里先按照ATE指令转换成MBGN
  // MatchLoop匹配内部单个Vector行（等于IMATCH），如果该行是pass就退出循环，Infinite=无限循环
  MatchLoop 2000 {
	  V {  _bidi_=00;
		   _pi_=001111111111111111111111111111111000000000000000000000000001;
	  }
  }
  // MatchLoop匹配内部所有Vector行直到所有都Pass才跳出循环（等于MBGN）
  MatchLoop 11 {
	  V {  _bidi_=00;
		   _pi_=001111111111111111111111111111111000000000000000000000000001;
	  }
	  Loop 10 {
		  V {  _bidi_=00;
			   _pi_=001111111111111111111111111111111000000000000000000000000000;
		  }
	  }
	  // BreakPoint; // 错误，因为没有最后一个V块填写Match结束指令
	  V {  _bidi_=00;
		   _pi_=001111111111111111111111111111111000000000000000000000000001;
	  }
	  BreakPoint; // 提前结束，后面的V块就变成普通块，没有BreakPonit时到末尾自动结束
	  V {  _bidi_=00;
		   _pi_=001111111111111111111111111111111000000000000000000000000001;
	  }
  }
  // (Label:)Loop内部一个V块=RPT
  RPT1: Loop 90 {
	  V {  _bidi_=00;
		   _pi_=001111111111111111111111111111111000000000000000000000000000;
	  }
  } RPT2: Loop 91 { // 块在同一行
	  V {  _bidi_=00;
		   _pi_=001111111111111111111111111111111000000000000000000000000000;
	  }
  }
  V {  _bidi_=10;
       _pi_=001111111111111111111111111111111000000000000000000000000000;
  }
  // Loop内部多个V块=LIm和JNIm
  Loop 10 {
	  V {  _bidi_=00;
		   _pi_=001111111111111111111111111111111000000000000000000000000000;
	  }
	  V {  _bidi_=00;
		   _pi_=001111111111111111111111111111111000000000000000000000000000;
	  }
  }
  // 支持两层Loop嵌套循环
  Loop 30 {
	  // 嵌套循环内部Loop前面要有最少一个块，否则指令没有位置放
	  V {  _bidi_=00;
		   _pi_=001111111111111111111111111111111000000000000000000000000001;
	  }
	  Loop 300 {
		  V {  _bidi_=00;
			   _pi_=001111111111111111111111111111111000000000000000000000000001;
		  }
		  V {  _bidi_=00;
			   _pi_=001111111111111111111111111111111000000000000000000000000001;
		  }
	  }
	  llabel1: V {  _bidi_=10;
		   _pi_=001111111111111111111111111111111000000000000000000000000001;
	  }
	  // 嵌套循环内部Loop后面要有最少一个块，否则JIm指令没有位置放
	  V {  _bidi_=10;
		   _pi_=001111111111111111111111111111111000000000000000000000000001;
	  }
  }
  // 支持切换Timing
  W tset_gen_tp2;
  //TDI, TMS=1,1 for Contact check, Need to add Wait time for 60secs
  Loop 60 {
	  V {  _bidi_=01;
		   _pi_=111111111111111111111111111111111000000000000000000000000001;
	  }
  }
  //(Label:)Stop=HALT
  // 单指令的vector会用.占位
  stop: Stop;
  // 支持未知指令解析，未知指令的vector会用.占位
  UNKNOWN SEQ;
  UNKNOWN;
  }
